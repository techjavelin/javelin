import { a } from '@aws-amplify/backend';

export const FindingStatus = a.enum([
  'OPEN','IN_PROGRESS','REMEDIATED','ACCEPTED_RISK','FALSE_POSITIVE','DUPLICATE'
]);

export const PublicationStatus = a.enum([
  'DRAFT','PUBLISHED'
]);

export const VulnerabilityFinding = a.model({
  engagementId: a.id().required(),
  applicationId: a.id().required(),
  templateId: a.id(),
  title: a.string().required(),
  severity: a.ref('Severity').required(),
  status: a.ref('FindingStatus').required(),
  description: a.string(),
  impact: a.string(),
  impactLevel: a.string(),
  likelihood: a.string(),
  reproduction: a.string(),
  evidence: a.json(), // array of objects { type, url?, caption, data? }
  remediation: a.string(),
  references: a.string().array(),
  affectedAssets: a.string().array(),
  publicationStatus: a.ref('PublicationStatus').required(),
  cvssVector: a.string(),
  cvssScore: a.float(),
  reportedAt: a.datetime(),
  updatedAt: a.datetime(),
  closedAt: a.datetime(),
  createdBy: a.string(),
})
  .authorization(allow => [
    allow.group('admin'),
    allow.group('pentester').to(['create','read','update']),
    allow.authenticated().to(['read']),
  ]);
